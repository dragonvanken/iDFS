 // ç¼–è¯‘å‘½ä»¤ ï¼špython -m grpc_tools.protoc --python_out=. --grpc_python_out=. -I. DataForMaster.proto
syntax = "proto3";

// è¿™æ˜¯æ•°æ®æœåŠ¡å™¨Serverä¸ºæ§åˆ¶æœåŠ¡å™¨Masteræä¾›çš„æœåŠ¡DFMçš„åè®®

service DFM {
    //äº‹ç‰©ï¼šchunkåˆ é™¤
    //æœåŠ¡ï¼šmasteråˆ é™¤æ•°æ®æœåŠ¡å™¨ä¸Šçš„chunk
    //è¯·æ±‚ï¼šchunkID
    //è¿”å›ï¼šçŠ¶æ€ç 
    rpc deleteChunkOnDataServer(chunkID) returns (ACK1) {}
    //äº‹ç‰©ï¼šå¼‚å¸¸å¤„ç†ã€å¤‡ä»½
    //æœåŠ¡ï¼šchunkä»æœåŠ¡å™¨å¤åˆ¶åˆ°åˆ«çš„æœåŠ¡å™¨ä¸Š
    //è¯·æ±‚ï¼šå°†è¢«å¤åˆ¶çš„cidï¼Œå‘å¾€æ–°çš„æœåŠ¡å™¨ipï¼Œportï¼Œæ–°çš„cid
    //è¿”å›ï¼šçŠ¶æ€ç 
    rpc copyChunkBetweenDataServer(copyChunk) returns (ACK1) {}

    //æœåŠ¡ï¼šæäº¤æ–‡ä»¶å—
    //è¯·æ±‚ï¼šæ–‡ä»¶å—id
    //è¿”å›ï¼šçŠ¶æ€ğŸ‡
    rpc recommitChunk(chunkID) returns (ACK1) {}
}

message copyChunk {
    int32 CID = 1;
    string copyip = 2;
    int32 copyport = 3;
    int32 copycid = 4;
}

message chunkID {
    int32 CID = 1;
}

message ACK1{
    bool feedback = 1;
}
